相关链接：https://www.jianshu.com/p/fc95603b8cf0

#### 1、为什么利用多个域名来存储网站资源会更有效

1. CDN 缓存更方便
2. 突破浏览器并发限制
3. 节约 `cookie` 带宽
4. 节约主域名的连接数，优化页面响应速度
5. 防止不必要的安全问题

#### 2、从输入URL到页面加载全过程

1. 全过程详情

2. 缓存策略

3. http和https 的区别

4. dns 解析

5. 同源策略

6. 处理跨域方案

7. TCP/IP连接和三次握手

8. 浏览器 dom 渲染机制

   ##### 2.1 加载过程简介

   - 用户输入url
   - 根据用户的url,判断获取是否直接取缓存数据(强缓存)，还是重新获取数据(协商缓存)
   - dns 解析url为对应的ip地址
   - 客户端根据ip,通过tcp/ip的三次握手，和服务器建立连接
   - 客户端发起http 请求
   - 服务器接收到请求，返回数据
   - 浏览器根据返回数据，渲染页面
   - tcp四次挥手，断开连接

   ##### 2.2 强制缓存和协商缓存

   参考资料：https://juejin.im/entry/5ad86c16f265da505a77dca4

   ###### 强缓存：能够拿到本地缓存的情况下，直接使用本地的缓存，不用跟服务器进行通信；拿不到本地缓存，就会直接去服务器请求缓存；

   ###### 协商缓存：将资源一些相关信息返回服务器，让服务器判断浏览器是否能直接使用本地缓存或者从服务器返回新的数据，写入缓存，整个过程至少与服务器通信一次

   强缓存相关字段： expires(很少使用，存在服务器时间和浏览器时间不一致的情况)**、**cache-control中的max-age字段(优先级高于 expires）

   协商缓存相关字段：Last-Modified/If-Modified-Since(客户端再次请求时带上)、Etag/If-None-Match(客户端再次请求时带上)，Etag/If-None-Match优先级比Last-Modified/If-Modified-Since 高

   ##### 2.3 Http 和Https请求

   Http 请求包括起始行，请求头和请求体三部分

   ###### 起始行

   >http 协议版本、请求方式、url地址

   

   ##### 2.4 dns 解析

   dns 解析：将 url 地址通过一定映射规则，找到对应的ip地址

   ###### 方式
   
   > 1、先在本地hosts 文件中，找到映射的ip地址，找到就返回，没有找到就继续第二步；
   >
   > 2、在本地的dns 解析器缓存中查找，找到就返回，找不到继续第3步骤；
   >
   > 3、在本地的dns 服务器其中查找，找到就返回，没有找到，继续下面的迭代查找；
>
   > 4、按根域服务器 ->顶级域,.cn->第二层域，[hb.cn](https://link.jianshu.com/?t=http://hb.cn) ->子域，[www.hb.cn](https://link.jianshu.com/?t=http://www.hb.cn)的顺序找到IP地址.
   
   PS：在第4个步骤中，先查询域，通过第四个步骤中的顺序，直到找到对应的域和对应的ip，然后从最底层，逐级向上找，返回对应的IP

####3、回流和重绘

###### 回流/重排

> 当dom发生位置、大小、内容和解构等的变化，就会触发dom重新渲染，成为回流，回流的代价很大，尽量不要触发回流，会影响到页面布局

###### 重绘

>当影响dom的外观，发生改变时，就会触发重绘，比如说，颜色、字体大小等。重绘的代价比回流的代价小，不会影响到布局

**回流一定会引起重绘，重绘不一定引起回流**



#### 4、为何将资源放在多个域名之下效率会更高？

1. 节约***cookie***带宽；
2. 使用***cnd缓存***，可以更快的获取到缓存数据，节省用户时间；
3. 节约***主域名***连接数，访问主要网页时，首先会访问主域名下各种资源，由于同一域名下有***访问连接数***的限制，因此将资源放在不同的域名之下，可以节约访问主域名访问连接数；
4. 突破***浏览器并发连接***限制，由于同一域名下有***访问连接数***的限制，因此将资源放在不同的域名之下，可以突破访问连接数的限制；
5. 避免不必要的安全问题。

#### 5、同源策略

```
 受同源策略的限制，只有同源网站的 Cookie才能共享。

   1.cookie
    cookie只有同源的网站才能获取，但是如果两个网页的一级域名相同，只有二级域名不同，可以设置相同的document.domain，两个网页就可以共享cookie了

    域名的等级划分：

顶级域名：.com
一级域名：baidu.com
二级域名：tieba.baidu.com
  例如，a网页是http://abc.com/a.html，b网页是http://abc.com/b.html，我们可以设置document,.domain = 'abc.com',a与b可以共享cookie
```

#### 6、跨域

跨域原因：由于同源策略的影响，不能访问不同源的资源，需要访问就会产生跨域

跨域方式：CORS、JSONP、WebSocket

###### JSONP:只能是 get 请求

>本质是因为能够访问不同域名下的js文件。
>
>生成一个script 标签，将需要访问的请求作为src的属性值，同时在请求中添加callback作为请求参数，在脚本中执行回调函数，请求成功之后的数据在回调函数中获取；

***主要参数***

>参数
>
>dataType:'jsonp', // 返回的数据类型
>
>JsonpCallback:'cb' // 指定回调函数类型
>
>Jsonp:'newCallback' // 指定回调函数属性的名称，将callback改为newCallback

1、默认回调函数success

![image-20200227133743483](/Users/franklin/Library/Application Support/typora-user-images/image-20200227133743483.png)

2、指定回调函数

![image-20200227133628485](/Users/franklin/Library/Application Support/typora-user-images/image-20200227133628485.png)

###### CORS：需要在服务端进行配置

本质是使用自定义的HTTP头部允许浏览器和服务器相互访问对方

***主要参数***

> Access-Control-Allow-Origin // 指定能够授权访问的域，* 表示所有的域
>
> Access-Control-Allow-Methods // 授权使用的方法，不限于get，包括post、delete、put等

![image-20200227141022429](/Users/franklin/Library/Application Support/typora-user-images/image-20200227141022429.png)

###### WebSocket

#### 7、Session、Cookie和各种缓存

Session 和 Cookie 存储的是状态信息；

浏览器缓存 存储在memory cache 和disk cache 中，进程关闭，该进程中缓存在memory cache 中的资源将消失

memeory cache 缓存时效性高、速度快，通常存储静态图片等内容，disk cache 通常缓存复杂，体积比较大的内容，css 文件等。

***协商缓存和强制缓存 参照 2.2 节***

#### 8、浏览器渲染机制

参考资料：https://juejin.im/entry/59e1d31f51882578c3411c77

######渲染过程

>1. 处理 HTML 标记并构建 DOM 树。
>2. 处理 CSS 标记并构建 CSSOM 树。
>3. 将 DOM 与 CSSOM 合并成一个渲染树。
>4. 根据渲染树来布局，以计算每个节点的几何信息。
>5. 将各个节点绘制到屏幕上。

###### 优化加载js文件

https://blog.csdn.net/liuhe688/article/details/51247484

>***deder***:本质是开启了另一个线程加载脚本。
>
>1、在加载解析dom 解构的同时，也会加载js 文件。拥有defer属性的script 标签，会在dom加载解析完成和js 文件加载完成之后，再运行解析js代码
>
>2、如果有多个defer的脚本执行，会按照顺序执行
>
>3、defer只使用在外联脚本中，内联脚本没有效果
>
>4、`defer`脚本会在`DOMContentLoaded`和`load`事件之前执行
>
>
>
>***async***:`async`和`defer`一样，不会阻塞当前文档的解析，它会异步地下载脚本，但和`defer`不同的是，`async`会在脚本下载完成后立即执行，如果项目中脚本之间存在依赖关系，不推荐使用`async`
>
>1. 只适用于外联脚本，这一点和`defer`一致
>2. 如果有多个声明了`async`的脚本，其下载和执行也是异步的，不能确保彼此的先后顺序
>3. `async`会在`load`事件之前执行，但并不能确保与`DOMContentLoaded`的执行先后顺序

#### 9、防抖和节流（了解实现原理）

>**防抖**：高频事件触发后，在一定的时间间隔执行一次，重复触发，在此计算时间
>
>**节流**：高频事件在一定的时间内只执行一次
>
>**原因**：1、节约连接访问资源；2、减少浏览器渲染的代价(回流和重绘)

####10、原型和继承